{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container" style="padding-bottom: 10vh;">
    <div class="row justify-content-center mt-5">
        <div class="col-lg-6">
            <div class="card shadow-lg p-5 custom-form">
                <h2 class="mb-4 text-center">Edit Farm Location</h2>
                <form method="POST">
                    {% csrf_token %}
                
                    <label for="id_name">Name:</label>
                    {{ form.name }}
                    
                    <label for="id_address">Address:</label>
                    {{ form.address }}

                    <label for="id_description">Address:</label>
                    {{ form.description }}
                
                    <label for="id_latitude">Latitude:</label>
                    {{ form.latitude }}
                    
                    <label for="id_longitude">Longitude:</label>
                    {{ form.longitude }}
                
                    <label for="id_grower">Grower:</label>
                    {{ form.grower }}
                    <br>
                    
                    <!-- The Leaflet map -->
                    <div id="map" style="height: 400px;"></div>
                    <br>
                    <button class="btn btn-primary" type="submit">Save Changes</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Include Leaflet.js and Map Script -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

<script>
    // Set the initial latitude and longitude values from the form (if editing an existing location)
    var initialLat = {{ farm_location.latitude }};
    var initialLng = {{ farm_location.longitude }};
    
    var map = L.map('map').setView([initialLat, initialLng], 13);  // Center map on existing farm location
    
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Add a marker to the map at the initial coordinates
    var marker = L.marker([initialLat, initialLng]).addTo(map);

    // On map click, update marker and form input values
    map.on('click', function (e) {
        var lat = e.latlng.lat.toFixed(6);
        var lng = e.latlng.lng.toFixed(6);
    
        // Update marker position
        marker.setLatLng([lat, lng]);
    
        // Update form fields with selected latitude and longitude values
        document.getElementById('id_latitude').value = lat;
        document.getElementById('id_longitude').value = lng;
    });
</script>

{% endblock %}
